<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Scroll Hero Test</title>
<style>
  html,body{margin:0}
  /* 다른 섹션 간섭 방지용 스페이서 */
  .spacer{height:120vh;background:#f5f5f5;display:flex;align-items:center;justify-content:center;font:16px/1.4 system-ui}

  /* ===== Scroll Hero ===== */
  #design-hero.scroll-hero{ height:calc(100vh * 4); position:relative; z-index:1; }
  #design-hero .sh-sticky{ position:sticky; top:0; height:100vh; overflow:hidden; background:#000; }
  .sh-slide{ position:absolute; inset:0; opacity:0; transition:opacity .6s ease, transform .8s ease; }
  .sh-slide.is-active{ opacity:1; }
  .sh-slide img{ width:100%; height:100%; object-fit:cover; transform:scale(1.05); transition:transform .8s ease }
  .sh-slide.is-active img{ transform:scale(1) }
  .sh-slide figcaption{ position:absolute; left:5vw; bottom:8vh; right:5vw; color:#fff; text-shadow:0 2px 10px rgba(0,0,0,.5) }
  .sh-dots{ position:absolute; left:5vw; bottom:4vh; display:flex; gap:8px }
  .sh-dots i{ width:10px; height:10px; border-radius:50%; background:rgba(255,255,255,.35); transition:.2s }
  .sh-dots i.is-on{ background:#fff; transform:scale(1.2) }

  /* 센티널(트리거) 묶음: sticky 바깥! */
  .sh-sentinels{ position:relative }
  .sh-sentinel{ height:100vh } /* 슬라이드 수 만큼 1:1 */
</style>
</head>
<body>

<div class="spacer">위 컨텐츠 (테스트용 스페이서)</div>

<section id="design-hero" class="scroll-hero">
  <div class="sh-sticky">
    <figure class="sh-slide is-active">
      <img src="img/design1-1.png" alt="">
      <figcaption><h3>현대</h3><p>설명…</p></figcaption>
    </figure>
    <figure class="sh-slide">
      <img src="img/design1-2.png" alt="">
      <figcaption><h3>근현대</h3><p>설명…</p></figcaption>
    </figure>
    <figure class="sh-slide">
      <img src="img/design1-3.png" alt="">
      <figcaption><h3>조선시대</h3><p>설명…</p></figcaption>
    </figure>
    <figure class="sh-slide">
      <img src="img/design1-4.png" alt="">
      <figcaption><h3>논밭</h3><p>설명…</p></figcaption>
    </figure>
    <div class="sh-dots" aria-hidden="true"></div>
  </div>
</section>

<div class="spacer">아래 컨텐츠 (테스트용 스페이서)</div>

<script>
window.addEventListener('load', () => {
  const root = document.querySelector('#design-hero');
  const sticky = root.querySelector('.sh-sticky');
  const slides = [...root.querySelectorAll('.sh-slide')];

  // 점
  const dotsBox = sticky.querySelector('.sh-dots');
  dotsBox.innerHTML = slides.map(()=>'<i></i>').join('');
  const dots = [...dotsBox.querySelectorAll('i')];

  // 센티널을 sticky "바깥"에 둔다
  let sentinelsWrap = document.querySelector('.sh-sentinels');
  if(!sentinelsWrap){
    sentinelsWrap = document.createElement('div');
    sentinelsWrap.className = 'sh-sentinels';
    root.insertAdjacentElement('afterend', sentinelsWrap); // ★ sticky 밖
  }
  sentinelsWrap.innerHTML = '';
  slides.forEach((_,i)=>{
    const s = document.createElement('div');
    s.className = 'sh-sentinel';
    s.dataset.index = i;
    sentinelsWrap.appendChild(s);
  });

  // 상태
  let current = -1;
  function setIndex(i){
    if(i === current) return;
    current = i;
    slides.forEach((el,idx)=>el.classList.toggle('is-active', idx===i));
    dots.forEach((el,idx)=>el.classList.toggle('is-on', idx===i));
    console.log('[slide]', i+1, '/', slides.length); // 디버그 로그
  }
  setIndex(0);

  // 옵저버: 화면 중앙(-40%, -40%) 근방에 센티널 들어오면 전환
  const io = new IntersectionObserver((entries)=>{
    const mid = window.innerHeight/2;
    let best = null;
    entries.forEach(e=>{
      if(!e.isIntersecting) return;
      const r = e.target.getBoundingClientRect();
      const c = r.top + r.height/2;
      const dist = Math.abs(c - mid);
      if(!best || dist < best.dist) best = { idx: parseInt(e.target.dataset.index,10), dist };
    });
    if(best) setIndex(best.idx);
  }, { root:null, rootMargin:'-40% 0% -40% 0%', threshold:0 });

  sentinelsWrap.querySelectorAll('.sh-sentinel').forEach(s=>io.observe(s));

  // 프리로드(선택)
  slides.forEach(s=>{ const img=s.querySelector('img'); if(img?.src){ const im=new Image(); im.src=img.src; }});
});
</script>
</body>
</html>
